# 9장. 스트리밍 조인
## 모든 조인은 스트리밍에 속한다
##### 두 데이터셋을 조인한다는 것은 무슨 뜻일까?
- 직관적으로 조인은 특정 유형의 그룹핑 작업임을 알수 있다. 6장에서 배운 것처럼 그룹핑 작업은 항상 스트림을 소비하고 테이블을 생성한다.
- 조인은 일부 속성(키)을 공유하는 데이터를 결합함으로써 서로 관련이 없던 개별 데이터를 관련된 요소로 모으는 역할을 한다.

모든 조인은 사실상 스트리밍 조인이다(갑자기?). 윈도우, 워터마크, 트리거 등 스트리밍 그룹핑 작업의 모든 도구들은 스트리밍 조인에도 적용된다.

구체적인 예로 설명하기 위해, 다음과 같은 데이터셋에 여러 조인을 적용해보자.

## 윈도우 없는 조인
윈도우 설정은 조인의 의미에 큰 영향을 주지 않기 때문에 먼저 윈도우가 없는 조인을 살펴보려고 한다.
조인은 단순히 특정 유형의 그룹핑 작업이며, 이 그룹핑 작업의 결과는 테이블이다. 따라서 윈도우 없는 조인(다르게 표현하면, 단일 글로벌 윈도우 내에서의 조인)에 의해 생성된 테이블을 스트림으로 소비하려면, 모든 입력을 볼 때까지 기다리는 대신 언그룹핑(혹은 트리거) 작업만 적용하면 된다.
> 매 레코드마다 트리거, 주기적으로 트리거 등

조인 결과를 스트림으로 관찰하는 예에서는 레코드 단위 트리거를 사용한다고 가정한다.

#### 조인 종류
ANSI SQL은 FULL OUTER, LEFT OUTER, RIGHT OUTER, INNER, CROSS 다섯 가지 조인을 정의하고 있으며 이를 하나씩 살펴보자. 또한 ANTI 및 SEMI 조인도 다룰 것이다. 조인의 종류가 많은 것처럼 보일 수 있다. 그러나 핵심에는 FULL OUTER 조인이 있고, 다른 모든 조인은 하위 집합에 속한다.

### FULL OUTER
두 데이터셋을 FULL OUTER 조인한 결과는 두 데이터셋의 전체 행이 된다. 동일한 조인 키를 공유하는 두 행이 결합되지만, 그렇지 않은 행도 결합되지 않은 상태로 포함된다.
```
SELECT TABLE
  left.ID as L,
  right.Id as R
FROM left FULL OUTER JOIN right
ON L.num = R.num;
```

이는 모든 데이터가 시스템에 도착한 후 조인 관계의 스냅샷이다.

스트리밍 조인은 시간의 차원을 포함한다. 주어진 데이터셋/관계가 시간에 따라 어떻게 변하는지 이해하고 싶다면, 시간 변이 관계(TVR)를 확인해야 한다.
```
SELECT TVR
  left.ID as L,
  right.Id as R
FROM left FULL OUTER JOIN right
ON L.num = R.num;
```

TVR의 스트림을 생성하면 각 스냅샷 간의 차이를 보여준다.
```
SELECT STREAM
  left.ID as L,
  right.Id as R,
  CURRENT_TIMESTAMP as time,
  Sys.Undo as Undo
FROM left FULL OUTER JOIN right
ON L.num = R.num;
```

지정된 행이 스트림에서 구체화되는 시간을 보여주는 Time 열과, 해당 열의 이전 결과를 철회하고 결과를 갱신함을 표시하는 Undo 열을 포함하고 있다.

조인의 테이블, TVR, 스트림의 세 가지 표현은 서로 다른 모습을 갖지만 동일한 데이터를 어떻게 다르게 보여주는지 명확하다. 
- 테이블 스냅샷: 모든 데이터가 도착한 후 존재하는 전체 데이터셋을 보여준다.
- TVR, 스트림: 각각의 방법으로 존재하는 동안 전체 관계의 변화를 담아낸다.

### LEFT OUTER
LEFT OUTER 조인은 오른쪽 데이터셋에서 조인되지 않은 행이 제거된 FULL OUTER 조인이다.

### RIGHT OUTER
RIGHT OUTER 조인은 LEFT OUTER 조인의 반대다. FULL OUTER 조인의 왼쪽 데이터셋에서 조인되지 않은 모든 행이 제거된다.

### INNER
INNER 조인은 LEFT OUTER 조인과 RIGHT OUTER 조인의 교집합이다. 결과적으로 양쪽 모두에서 조인 되지 않고 남아 있는 행들은 INNER 조인에서 사라진다.

### ANTI
ANTI 조인은 INNER 조인과 반대로 조인되지 않은 모든 행을 포함한다.

### SEMI

